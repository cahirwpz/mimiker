version: 2
jobs:
  build:
    working_directory: ~/mimiker
    docker:
      - image: rafalcieslak/mimiker-build-base:1.0
    steps:
      - checkout
      - run:
          name: 'Verify formatting'
          command: './verify-format.sh'
      - run:
          name: 'Verify PEP8'
          command: './verify-pep8.sh'
      - run:
          name: 'Make'
          command: 'make'
      - store_artifacts:
          path: mimiker.elf
          prefix: kernel_image
      - store_artifacts:
          path: initrd.cpio
          prefix: ramdisk
      - run:
          name: 'Run kernel tests'
          command: './run_tests.py --thorough'